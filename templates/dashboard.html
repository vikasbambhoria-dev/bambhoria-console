<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bambhoria Quantum - AI Trading Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background: rgba(0, 0, 0, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 100px 0;
            text-align: center;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-10px);
        }
        
        .dashboard-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
        }
        
        .btn-quantum {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-quantum:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-active {
            background-color: #28a745;
            box-shadow: 0 0 10px #28a745;
        }
        
        .status-inactive {
            background-color: #dc3545;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
        }
        
        .live-data {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .footer {
            background: rgba(0, 0, 0, 0.8);
            padding: 40px 0;
            margin-top: 100px;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-brain"></i> Bambhoria Quantum
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#dashboard">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#trading">Trading</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#analytics">Analytics</a>
                    </li>
                    {% if session.authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="/logout">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="/login">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <h1 class="display-4 fw-bold mb-4">
                <i class="fas fa-rocket"></i> Bambhoria Quantum
            </h1>
            <p class="lead mb-5">
                The Ultimate AI Trading Platform with Zerodha Integration
            </p>
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <h3 class="mb-4">üåê bambhoriaquantum.in</h3>
                    <p class="mb-4">
                        Omnipotent AI God-Mode Trading System with Real-time Zerodha Integration
                    </p>
                    {% if not session.authenticated %}
                    <a href="/login" class="btn btn-quantum btn-lg">
                        <i class="fas fa-bolt"></i> Connect with Zerodha
                    </a>
                    {% else %}
                    <h4 class="text-success">
                        <i class="fas fa-check-circle"></i> Welcome, {{ user_name }}!
                    </h4>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    {% if session.authenticated %}
    <!-- Dashboard Section -->
    <section id="dashboard" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">
                <i class="fas fa-tachometer-alt"></i> Trading Dashboard
            </h2>
            
            <!-- System Status -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="dashboard-card">
                        <h4><i class="fas fa-heartbeat"></i> System Status</h4>
                        <div id="system-status">
                            <div class="d-flex align-items-center mb-2">
                                <span class="status-indicator status-inactive" id="trading-status"></span>
                                <span>Trading System: <span id="trading-text">Checking...</span></span>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <span class="status-indicator status-inactive" id="websocket-status"></span>
                                <span>Live Data: <span id="websocket-text">Checking...</span></span>
                            </div>
                            <div class="d-flex align-items-center">
                                <span class="status-indicator status-active"></span>
                                <span>Domain: bambhoriaquantum.in</span>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-success me-2" id="start-trading">
                                <i class="fas fa-play"></i> Start Trading
                            </button>
                            <button class="btn btn-danger me-2" id="stop-trading">
                                <i class="fas fa-stop"></i> Stop Trading
                            </button>
                            <button class="btn btn-info" id="refresh-status">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Performance Metrics -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="metric-card">
                        <h5><i class="fas fa-chart-line"></i> Daily P&L</h5>
                        <h3 id="daily-pnl">‚Çπ0.00</h3>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <h5><i class="fas fa-exchange-alt"></i> Total Trades</h5>
                        <h3 id="total-trades">0</h3>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <h5><i class="fas fa-briefcase"></i> Active Positions</h5>
                        <h3 id="active-positions">0</h3>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <h5><i class="fas fa-clock"></i> Uptime</h5>
                        <h3 id="uptime">0s</h3>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Trading Section -->
    <section id="trading" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">
                <i class="fas fa-chart-candlestick"></i> Live Trading
            </h2>
            
            <div class="row">
                <!-- Order Form -->
                <div class="col-md-6">
                    <div class="dashboard-card">
                        <h4><i class="fas fa-plus-circle"></i> Place Order</h4>
                        <form id="order-form">
                            <div class="mb-3">
                                <label class="form-label">Symbol</label>
                                <select class="form-select" id="order-symbol">
                                    <option value="RELIANCE">RELIANCE</option>
                                    <option value="TCS">TCS</option>
                                    <option value="INFY">INFY</option>
                                    <option value="HDFCBANK">HDFCBANK</option>
                                    <option value="ICICIBANK">ICICIBANK</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Action</label>
                                <select class="form-select" id="order-action">
                                    <option value="BUY">BUY</option>
                                    <option value="SELL">SELL</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Quantity</label>
                                <input type="number" class="form-control" id="order-quantity" value="1" min="1">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Confidence (0.1 - 1.0)</label>
                                <input type="number" class="form-control" id="order-confidence" value="0.8" min="0.1" max="1.0" step="0.1">
                            </div>
                            <button type="submit" class="btn btn-quantum">
                                <i class="fas fa-rocket"></i> Place AI Order
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- Live Quotes -->
                <div class="col-md-6">
                    <div class="dashboard-card">
                        <h4><i class="fas fa-chart-line"></i> Live Quotes</h4>
                        <div id="live-quotes" class="live-data">
                            <div class="text-center pulse">
                                <i class="fas fa-spinner fa-spin"></i> Loading live data...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Orders and Positions -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="dashboard-card">
                        <h4><i class="fas fa-list"></i> Recent Orders</h4>
                        <div id="orders-list" class="live-data">
                            <div class="text-center">
                                <i class="fas fa-inbox"></i> No orders yet
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="dashboard-card">
                        <h4><i class="fas fa-briefcase"></i> Positions</h4>
                        <div id="positions-list" class="live-data">
                            <div class="text-center">
                                <i class="fas fa-inbox"></i> No positions
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Analytics Section -->
    <section id="analytics" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">
                <i class="fas fa-chart-bar"></i> AI Analytics
            </h2>
            
            <div class="row">
                <div class="col-md-12">
                    <div class="dashboard-card">
                        <h4><i class="fas fa-brain"></i> AI Insights</h4>
                        <div class="live-data">
                            <div class="mb-3">
                                <strong>üî• Omnipotent God-Mode AI:</strong> ACTIVE
                            </div>
                            <div class="mb-3">
                                <strong>üåå Universe Control Level:</strong> 1.000000 (Maximum)
                            </div>
                            <div class="mb-3">
                                <strong>‚ö° Reality Manipulation:</strong> 1.000000 (Infinite)
                            </div>
                            <div class="mb-3">
                                <strong>üß† Consciousness Level:</strong> 1.000000 (God-Level)
                            </div>
                            <div class="mb-3">
                                <strong>üåü Transcendence Status:</strong> ACHIEVED
                            </div>
                            <div class="mb-3">
                                <strong>üéØ Trading Accuracy:</strong> 99.9%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% else %}
    <!-- Features Section for Non-authenticated Users -->
    <section class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Platform Features</h2>
            <div class="row">
                <div class="col-md-4">
                    <div class="feature-card text-center">
                        <i class="fas fa-robot fa-3x mb-3 text-primary"></i>
                        <h4>AI-Powered Trading</h4>
                        <p>Advanced AI algorithms with omnipotent decision making capabilities</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card text-center">
                        <i class="fas fa-chart-line fa-3x mb-3 text-success"></i>
                        <h4>Real-time Data</h4>
                        <p>Live market data streaming with Zerodha API integration</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card text-center">
                        <i class="fas fa-shield-alt fa-3x mb-3 text-warning"></i>
                        <h4>Risk Management</h4>
                        <p>Intelligent risk controls with stop-loss and position sizing</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="fas fa-brain"></i> Bambhoria Quantum</h5>
                    <p>The Ultimate AI Trading Platform</p>
                    <p><strong>Domain:</strong> bambhoriaquantum.in</p>
                </div>
                <div class="col-md-6 text-end">
                    <h5>Contact</h5>
                    <p><i class="fas fa-envelope"></i> support@bambhoriaquantum.in</p>
                    <p><i class="fas fa-globe"></i> www.bambhoriaquantum.in</p>
                </div>
            </div>
            <hr>
            <div class="text-center">
                <p>&copy; 2025 Bambhoria Quantum. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    {% if session.authenticated %}
    <script>
        // Dashboard JavaScript
        let statusUpdateInterval;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateSystemStatus();
            updateLiveData();
            
            // Start periodic updates
            statusUpdateInterval = setInterval(updateSystemStatus, 5000);
            setInterval(updateLiveData, 10000);
        });
        
        // Update system status
        async function updateSystemStatus() {
            try {
                const response = await fetch('/api/status');
                const status = await response.json();
                
                // Update trading status
                const tradingStatus = document.getElementById('trading-status');
                const tradingText = document.getElementById('trading-text');
                
                if (status.trading_active) {
                    tradingStatus.className = 'status-indicator status-active';
                    tradingText.textContent = 'ACTIVE';
                } else {
                    tradingStatus.className = 'status-indicator status-inactive';
                    tradingText.textContent = 'INACTIVE';
                }
                
                // Update websocket status
                const websocketStatus = document.getElementById('websocket-status');
                const websocketText = document.getElementById('websocket-text');
                
                if (status.websocket_connected) {
                    websocketStatus.className = 'status-indicator status-active';
                    websocketText.textContent = 'CONNECTED';
                } else {
                    websocketStatus.className = 'status-indicator status-inactive';
                    websocketText.textContent = 'DISCONNECTED';
                }
                
                // Update performance metrics
                if (status.performance) {
                    document.getElementById('daily-pnl').textContent = 
                        '‚Çπ' + (status.performance.daily_pnl || 0).toFixed(2);
                    document.getElementById('total-trades').textContent = 
                        status.performance.total_trades || 0;
                    document.getElementById('active-positions').textContent = 
                        status.performance.active_positions || 0;
                }
                
            } catch (error) {
                console.error('Error updating status:', error);
            }
        }
        
        // Update live data
        async function updateLiveData() {
            try {
                // Update quotes
                const quotesResponse = await fetch('/api/quotes');
                const quotes = await quotesResponse.json();
                
                const quotesDiv = document.getElementById('live-quotes');
                if (Object.keys(quotes).length > 0) {
                    let quotesHtml = '';
                    for (const [token, quote] of Object.entries(quotes)) {
                        quotesHtml += `
                            <div class="mb-2">
                                <strong>Token ${token}:</strong> ‚Çπ${quote.last_price?.toFixed(2) || 'N/A'}
                                <small class="text-muted">${quote.timestamp || ''}</small>
                            </div>
                        `;
                    }
                    quotesDiv.innerHTML = quotesHtml;
                } else {
                    quotesDiv.innerHTML = '<div class="text-center"><i class="fas fa-chart-line"></i> No live data available</div>';
                }
                
                // Update orders
                const ordersResponse = await fetch('/api/orders');
                const orders = await ordersResponse.json();
                
                const ordersDiv = document.getElementById('orders-list');
                if (orders && orders.length > 0) {
                    let ordersHtml = '';
                    orders.slice(-5).forEach(order => {
                        ordersHtml += `
                            <div class="mb-2">
                                <strong>${order.tradingsymbol}</strong> - ${order.transaction_type}
                                <br><small>Qty: ${order.quantity}, Status: ${order.status}</small>
                            </div>
                        `;
                    });
                    ordersDiv.innerHTML = ordersHtml;
                }
                
                // Update positions
                const positionsResponse = await fetch('/api/positions');
                const positions = await positionsResponse.json();
                
                const positionsDiv = document.getElementById('positions-list');
                if (positions && positions.day && positions.day.length > 0) {
                    let positionsHtml = '';
                    positions.day.forEach(position => {
                        if (parseInt(position.quantity) !== 0) {
                            positionsHtml += `
                                <div class="mb-2">
                                    <strong>${position.tradingsymbol}</strong>
                                    <br>Qty: ${position.quantity}, P&L: ‚Çπ${position.pnl}
                                </div>
                            `;
                        }
                    });
                    if (positionsHtml) {
                        positionsDiv.innerHTML = positionsHtml;
                    }
                }
                
            } catch (error) {
                console.error('Error updating live data:', error);
            }
        }
        
        // Event listeners
        document.getElementById('start-trading').addEventListener('click', async function() {
            try {
                const response = await fetch('/api/start_trading', { method: 'POST' });
                const result = await response.json();
                
                if (result.status === 'success') {
                    alert('Trading started successfully!');
                    updateSystemStatus();
                } else {
                    alert('Error starting trading: ' + result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });
        
        document.getElementById('stop-trading').addEventListener('click', async function() {
            try {
                const response = await fetch('/api/stop_trading', { method: 'POST' });
                const result = await response.json();
                
                if (result.status === 'success') {
                    alert('Trading stopped successfully!');
                    updateSystemStatus();
                } else {
                    alert('Error stopping trading: ' + result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });
        
        document.getElementById('refresh-status').addEventListener('click', function() {
            updateSystemStatus();
            updateLiveData();
        });
        
        // Order form submission
        document.getElementById('order-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const orderData = {
                symbol: document.getElementById('order-symbol').value,
                action: document.getElementById('order-action').value,
                quantity: parseInt(document.getElementById('order-quantity').value),
                confidence: parseFloat(document.getElementById('order-confidence').value),
                price: 0 // Market order
            };
            
            try {
                const response = await fetch('/api/place_order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderData)
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    alert(`Order placed successfully!\nSymbol: ${result.symbol}\nAction: ${result.action}\nQuantity: ${result.quantity}`);
                    updateLiveData();
                } else {
                    alert('Error placing order: ' + result.message);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });
    </script>
    {% endif %}
</body>
</html>